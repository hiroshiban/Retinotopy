<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of mf_GenerateCheckerBoard1D</title>
  <meta name="keywords" content="mf_GenerateCheckerBoard1D">
  <meta name="description" content="Generates multi-focal checkerboard patterns (polar angle-based subdivision) with an individual ID number on each patch.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # Retinotopy --><!-- menu.html Generation -->
<h1>mf_GenerateCheckerBoard1D
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>Generates multi-focal checkerboard patterns (polar angle-based subdivision) with an individual ID number on each patch.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [checkerboard,bincheckerboard,mfcheckerboard,mask]=mf_GenerateCheckerBoard1D(rmin,rmax,width,ndivsP,ndivsE,startangle,pix_per_deg,nwedges,nrings,phase) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment" style="background-image:url(../../hb_brain.png); background-position:right top"><pre class="comment"> Generates multi-focal checkerboard patterns (polar angle-based subdivision) with an individual ID number on each patch.
 function [checkerboard,bincheckerboard,mfcheckerboard,mask]=mf_GenerateCheckerBoard1D(:rmin,:rmax,:width,:ndivsP,:ndivsE,:startangle,:pix_per_deg,:nwedges,:nrings,:phase)
 (: is optional)

 This function generates multi-focal checkerboards (polar-angle and eccentricity-based subdivisions)
 with an individual ID number on each patch.
 Each of two checkers have the compensating values of its counterpart.
 reference: Multifocal fMRI mapping of visual cortical areas.
            Vanni, S., Henriksson, L., James, A.C. (2005). Neuroimage, 27(1), 95-105.

 [input]
 rmin        : checkerboard's minimum radius in deg, [val], 0 by default.
 rmax        : checkerboard's maximum radius in deg, [val], 6 by default.
 width       : checker width in deg, [val], 360 by default.
 ndivsP      : the number of subdivisions of the visual field along the polar angle (against width (deg)), 12 by default.
               this value is for subdividing VISUAL FIELD for multi-focal retinotopy stimulation, not for checker pattern subdivisions.
 ndivsE      : the number of subdivisions of the visual field along the eccentricity (rmin-rmax deg), 3 by default.
               this value is for subdividing VISUAL FIELD for multi-focal retinotopy stimulation, not for checker pattern subdivisions.
 startangle  : checker board start angle, from right horizontal meridian, clockwise, 0 by default.
 pix_per_deg : pixels per degree, [val], 40 by default.
 nwedges     : number of wedges, [val], 36 by default.
               this value is used for checker pattern subdivisions.
 nrings      : number of rings, [val], 9 by default.
               this value is used for checker pattern subdivisions.
 phase       : (optional) checker's phase, 0 by default.

 [output]
 checkerboard    : output grayscale checkerboard, cell structure, {numel(startangle)}.
                   each pixel shows each checker patch's ID or background(0)
 bincheckerboard : (optional) binary (1/2=checker-patterns, 0=background) checkerboard patterns,
                   cell structure, {numel(startangle)}.
 mfcheckerboard  : (optional) checkerboard whose checker IDs are subdivided by ndivsP and ndivsE.
                   the pattern can be used for visual field subdivisions for multi-focal retinotpy stimuli.
 mask            : (optional) checkerboard regional mask, cell structure, logical


 Created    : &quot;2011-04-12 11:12:37 ban&quot;
 Last Update: &quot;2019-03-05 16:22:58 ban&quot;</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment" style="background-image:url(../../hb_brain.png); background-position:right top">
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../Retinotopy/Presentation/cmultifocal.html" class="code" title="function cmultifocal(subjID,exp_mode,acq,displayfile,stimulusfile,gamma_table,overwrite_flg,force_proceed_flag)">cmultifocal</a>	Color/luminance-defined multi-focal retinotopy checkerboard stimulus with checker-patch luminance change-detection tasks.</li><li><a href="../../Retinotopy/Presentation/cmultifocal_fixtask.html" class="code" title="function cmultifocal_fixtask(subjID,exp_mode,acq,displayfile,stimulusfile,gamma_table,overwrite_flg,force_proceed_flag)">cmultifocal_fixtask</a>	Color/luminance-defined multi-focal retinotopy checkerboard stimulus with fixation luminance change-detection tasks.</li><li><a href="../../Retinotopy/Presentation/dmultifocal.html" class="code" title="function dmultifocal(subjID,exp_mode,acq,displayfile,stimulusfile,gamma_table,overwrite_flg,force_proceed_flag)">dmultifocal</a>	Random-Dot-Stereogram(RDS)-defined multi-focal retinotopy checkerboard stimulus with checker-patch depth change-detection tasks.</li><li><a href="../../Retinotopy/Presentation/dmultifocal_fixtask.html" class="code" title="function dmultifocal_fixtask(subjID,exp_mode,acq,displayfile,stimulusfile,gamma_table,overwrite_flg,force_proceed_flag)">dmultifocal_fixtask</a>	Random-Dot-Stereogram(RDS)-defined multi-focal retinotopy checkerboard stimulus with fixation luminance change-detection tasks.</li><li><a href="../../Retinotopy/Presentation/gen_multifocal_windows.html" class="code" title="function stim_windows=gen_multifocal_windows(subjID,exp_mode,acq,displayfile,stimulusfile,overwrite_pix_per_deg,TR)">gen_multifocal_windows</a>	Generates multi-focal retinotopy stimulus windows for GLM modeling or pRF (population receptive field) analysis.</li><li><a href="../../Retinotopy/Presentation/imultifocal_fixtask.html" class="code" title="function imultifocal_fixtask(subjID,exp_mode,acq,displayfile,stimulusfile,gamma_table,overwrite_flg,force_proceed_flag)">imultifocal_fixtask</a>	Object-image-defined multi-focal retinotopy stimulus with fixation luminance change-detection tasks.</li></ul>
</div>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment" style="background-image:url(../../hb_brain.png); background-position:right top"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [checkerboard,bincheckerboard,mfcheckerboard,mask]=mf_GenerateCheckerBoard1D(rmin,rmax,width,ndivsP,ndivsE,startangle,pix_per_deg,nwedges,nrings,phase)</a>
0002 
0003 <span class="comment">% Generates multi-focal checkerboard patterns (polar angle-based subdivision) with an individual ID number on each patch.</span>
0004 <span class="comment">% function [checkerboard,bincheckerboard,mfcheckerboard,mask]=mf_GenerateCheckerBoard1D(:rmin,:rmax,:width,:ndivsP,:ndivsE,:startangle,:pix_per_deg,:nwedges,:nrings,:phase)</span>
0005 <span class="comment">% (: is optional)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% This function generates multi-focal checkerboards (polar-angle and eccentricity-based subdivisions)</span>
0008 <span class="comment">% with an individual ID number on each patch.</span>
0009 <span class="comment">% Each of two checkers have the compensating values of its counterpart.</span>
0010 <span class="comment">% reference: Multifocal fMRI mapping of visual cortical areas.</span>
0011 <span class="comment">%            Vanni, S., Henriksson, L., James, A.C. (2005). Neuroimage, 27(1), 95-105.</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% [input]</span>
0014 <span class="comment">% rmin        : checkerboard's minimum radius in deg, [val], 0 by default.</span>
0015 <span class="comment">% rmax        : checkerboard's maximum radius in deg, [val], 6 by default.</span>
0016 <span class="comment">% width       : checker width in deg, [val], 360 by default.</span>
0017 <span class="comment">% ndivsP      : the number of subdivisions of the visual field along the polar angle (against width (deg)), 12 by default.</span>
0018 <span class="comment">%               this value is for subdividing VISUAL FIELD for multi-focal retinotopy stimulation, not for checker pattern subdivisions.</span>
0019 <span class="comment">% ndivsE      : the number of subdivisions of the visual field along the eccentricity (rmin-rmax deg), 3 by default.</span>
0020 <span class="comment">%               this value is for subdividing VISUAL FIELD for multi-focal retinotopy stimulation, not for checker pattern subdivisions.</span>
0021 <span class="comment">% startangle  : checker board start angle, from right horizontal meridian, clockwise, 0 by default.</span>
0022 <span class="comment">% pix_per_deg : pixels per degree, [val], 40 by default.</span>
0023 <span class="comment">% nwedges     : number of wedges, [val], 36 by default.</span>
0024 <span class="comment">%               this value is used for checker pattern subdivisions.</span>
0025 <span class="comment">% nrings      : number of rings, [val], 9 by default.</span>
0026 <span class="comment">%               this value is used for checker pattern subdivisions.</span>
0027 <span class="comment">% phase       : (optional) checker's phase, 0 by default.</span>
0028 <span class="comment">%</span>
0029 <span class="comment">% [output]</span>
0030 <span class="comment">% checkerboard    : output grayscale checkerboard, cell structure, {numel(startangle)}.</span>
0031 <span class="comment">%                   each pixel shows each checker patch's ID or background(0)</span>
0032 <span class="comment">% bincheckerboard : (optional) binary (1/2=checker-patterns, 0=background) checkerboard patterns,</span>
0033 <span class="comment">%                   cell structure, {numel(startangle)}.</span>
0034 <span class="comment">% mfcheckerboard  : (optional) checkerboard whose checker IDs are subdivided by ndivsP and ndivsE.</span>
0035 <span class="comment">%                   the pattern can be used for visual field subdivisions for multi-focal retinotpy stimuli.</span>
0036 <span class="comment">% mask            : (optional) checkerboard regional mask, cell structure, logical</span>
0037 <span class="comment">%</span>
0038 <span class="comment">%</span>
0039 <span class="comment">% Created    : &quot;2011-04-12 11:12:37 ban&quot;</span>
0040 <span class="comment">% Last Update: &quot;2019-03-05 16:22:58 ban&quot;</span>
0041 
0042 <span class="comment">%% check the input variables</span>
0043 <span class="keyword">if</span> nargin&lt;1 || isempty(rmin), rmin=0; <span class="keyword">end</span>
0044 <span class="keyword">if</span> nargin&lt;2 || isempty(rmax), rmax=6; <span class="keyword">end</span>
0045 <span class="keyword">if</span> nargin&lt;3 || isempty(width), width=360; <span class="keyword">end</span>
0046 <span class="keyword">if</span> nargin&lt;4 || isempty(ndivsP), ndivsP=12; <span class="keyword">end</span>
0047 <span class="keyword">if</span> nargin&lt;5 || isempty(ndivsE), ndivsE=3; <span class="keyword">end</span>
0048 <span class="keyword">if</span> nargin&lt;6 || isempty(startangle), startangle=0; <span class="keyword">end</span>
0049 <span class="keyword">if</span> nargin&lt;7 || isempty(pix_per_deg), pix_per_deg=40; <span class="keyword">end</span>
0050 <span class="keyword">if</span> nargin&lt;8 || isempty(nwedges), nwedges=36; <span class="keyword">end</span>
0051 <span class="keyword">if</span> nargin&lt;9 || isempty(nrings), nrings=9; <span class="keyword">end</span>
0052 <span class="keyword">if</span> nargin&lt;10 || isempty(phase), phase=0; <span class="keyword">end</span>
0053 
0054 <span class="comment">%% parameter adjusting</span>
0055 
0056 <span class="comment">% convert deg to pixels</span>
0057 rmin=rmin*pix_per_deg;
0058 rmax=rmax*pix_per_deg;
0059 
0060 <span class="comment">% convert deg to radians</span>
0061 startangle=mod(startangle*pi/180,2*pi);
0062 width=width*pi/180;
0063 <span class="keyword">if</span> phase&gt;width/nwedges, phase=mod(phase,width/nwedges); <span class="keyword">end</span>
0064 phase=phase*pi/180;
0065 
0066 <span class="comment">% add small lim in checkerboard image, this is to avoid unwanted juggy edges</span>
0067 imsize_ratio=1.01;
0068 
0069 <span class="comment">% base xy distance field</span>
0070 [xx,yy]=meshgrid((0:1:imsize_ratio*2*rmax)-imsize_ratio*rmax,(0:1:imsize_ratio*2*rmax)-imsize_ratio*rmax);
0071 <span class="comment">%if mod(size(xx,1),2), xx=xx(1:end-1,:); yy=yy(1:end-1,:); end</span>
0072 <span class="comment">%if mod(size(xx,2),2), xx=xx(:,1:end-1); yy=yy(:,1:end-1); end</span>
0073 
0074 <span class="comment">% convert distance field to radians and degree fields</span>
0075 thetafield=mod(atan2(yy,xx),2*pi);
0076 
0077 <span class="comment">%% generating the checkerboard pattern</span>
0078 
0079 <span class="comment">% calculate binary class (-1/1) along eccentricity for checkerboard (anuulus)</span>
0080 radii=linspace(rmin,rmax,nrings+1); radii(1)=[]; <span class="comment">% annulus width</span>
0081 r=sqrt(xx.^2+yy.^2); <span class="comment">% radius</span>
0082 cid=zeros(size(xx)); <span class="comment">% checker id, eccentricity</span>
0083 <span class="keyword">for</span> i=length(radii):-1:1
0084   cid(rmin&lt;r &amp; r&lt;=radii(i))=i;
0085 <span class="keyword">end</span>
0086 
0087 <span class="comment">% calculate binary class (-1/1) along polar angle for checkerboard (wedge)</span>
0088 
0089 <span class="comment">% calculate inner regions</span>
0090 maxlim=mod(startangle+width,2*pi);
0091 <span class="keyword">if</span> startangle==maxlim <span class="comment">% whole annulus</span>
0092   inidx=find( (rmin&lt;=r &amp; r&lt;=rmax) );
0093 <span class="keyword">elseif</span> startangle&gt;maxlim
0094   inidx=find( (rmin&lt;=r &amp; r&lt;=rmax) &amp; ( (startangle&lt;=thetafield &amp; thetafield&lt;2*pi) | (0&lt;=thetafield &amp; thetafield&lt;=maxlim) ) );
0095 <span class="keyword">else</span>
0096   inidx=find( (rmin&lt;=r &amp; r&lt;=rmax) &amp; ( (startangle&lt;=thetafield) &amp; (thetafield&lt;=maxlim) ) );
0097 <span class="keyword">end</span>
0098 
0099 <span class="comment">% calculate wedge IDs</span>
0100 th=thetafield(inidx)-startangle+phase;
0101 th=mod(th,2*pi);
0102 cidp=zeros(size(thetafield));
0103 cidp(inidx)=ceil(th/width*nwedges); <span class="comment">% checker id, polar angle</span>
0104 
0105 <span class="comment">% correct wedge IDs</span>
0106 <span class="keyword">if</span> phase~=0 <span class="comment">%mod(phase,width/nwedges)~=0</span>
0107   cidp(inidx)=mod(cidp(inidx)-(2*pi/(width/nwedges)-1),2*pi/(width/nwedges))+1;
0108   minval=unique(cidp); minval=minval(2); <span class="comment">% not 1 because the first value is 0 = background;</span>
0109   cidp(cidp&gt;0)=cidp(cidp&gt;0)-minval+1;
0110   true_nwedges=numel(unique(cidp))-1; <span class="comment">% -1 is to omit 0 = background;</span>
0111 <span class="keyword">else</span>
0112   true_nwedges=nwedges;
0113 <span class="keyword">end</span>
0114 
0115 <span class="comment">% generate checker's ID</span>
0116 checkerboard=zeros(size(thetafield));
0117 checkerboard(inidx)=cidp(inidx)+(cid(inidx)-1)*true_nwedges;
0118 
0119 <span class="comment">% exclude outliers</span>
0120 <span class="comment">%checkerboard(r&lt;rmin | rmax&lt;r)=0;</span>
0121 checkerboard(checkerboard&lt;0)=0;
0122 
0123 <span class="comment">%% generate a binary (1/2=checker-patterns and 0=background) checkerboard</span>
0124 
0125 <span class="keyword">if</span> nargout&gt;=2
0126   rings=zeros(size(cid));
0127   rings(inidx)=2*mod(cid(inidx),2)-1; <span class="comment">% -1/1 class;</span>
0128 
0129   wedges=zeros(size(cidp));
0130   wedges(inidx)=2*mod(cidp(inidx),2)-1; <span class="comment">% -1/1 class</span>
0131 
0132   bincheckerboard=zeros(size(thetafield));
0133   bincheckerboard(inidx)=wedges(inidx).*rings(inidx);
0134   bincheckerboard(r&gt;rmax)=0;
0135   bincheckerboard(bincheckerboard&lt;0)=2;
0136 <span class="keyword">end</span>
0137 
0138 <span class="comment">%% generate a checkerboard subdivided by ndivsP and ndivsE for multi-focal retinotopy stimuli</span>
0139 
0140 <span class="keyword">if</span> nargout&gt;=3
0141   <span class="comment">% calculate binary class (-1/1) along eccentricity for checkerboard (anuulus)</span>
0142   radii=linspace(rmin,rmax,ndivsE+1); radii(1)=[]; <span class="comment">% annulus width</span>
0143   r=sqrt(xx.^2+yy.^2); <span class="comment">% radius</span>
0144   cid=zeros(size(xx)); <span class="comment">% checker id, eccentricity</span>
0145   <span class="keyword">for</span> i=length(radii):-1:1
0146     cid(rmin&lt;r &amp; r&lt;=radii(i))=i;
0147   <span class="keyword">end</span>
0148 
0149   <span class="comment">% calculate binary class (-1/1) along polar angle for checkerboard (wedge)</span>
0150 
0151   <span class="comment">% calculate inner regions</span>
0152   maxlim=mod(startangle+width,2*pi);
0153   <span class="keyword">if</span> startangle==maxlim <span class="comment">% whole annulus</span>
0154     inidx=find( (rmin&lt;=r &amp; r&lt;=rmax) );
0155   <span class="keyword">elseif</span> startangle&gt;maxlim
0156     inidx=find( (rmin&lt;=r &amp; r&lt;=rmax) &amp; ( (startangle&lt;=thetafield &amp; thetafield&lt;2*pi) | (0&lt;=thetafield &amp; thetafield&lt;=maxlim) ) );
0157   <span class="keyword">else</span>
0158     inidx=find( (rmin&lt;=r &amp; r&lt;=rmax) &amp; ( (startangle&lt;=thetafield) &amp; (thetafield&lt;=maxlim) ) );
0159   <span class="keyword">end</span>
0160 
0161   <span class="comment">% calculate wedge IDs</span>
0162   th=thetafield(inidx)-startangle+phase;
0163   th=mod(th,2*pi);
0164   cidp=zeros(size(thetafield));
0165   cidp(inidx)=ceil(th/width*ndivsP); <span class="comment">% checker id, polar angle</span>
0166 
0167   <span class="comment">% correct wedge IDs</span>
0168   <span class="keyword">if</span> phase~=0 <span class="comment">%mod(phase,width/ndivsP)~=0</span>
0169     cidp(inidx)=mod(cidp(inidx)-(2*pi/(width/ndivsP)-1),2*pi/(width/ndivsP))+1;
0170     minval=unique(cidp); minval=minval(2); <span class="comment">% not 1 because the first value is 0 = background;</span>
0171     cidp(cidp&gt;0)=cidp(cidp&gt;0)-minval+1;
0172     true_nwedges=numel(unique(cidp))-1; <span class="comment">% -1 is to omit 0 = background;</span>
0173   <span class="keyword">else</span>
0174     true_nwedges=ndivsE;
0175   <span class="keyword">end</span>
0176 
0177   <span class="comment">% generate checker's ID</span>
0178   mfcheckerboard=zeros(size(thetafield));
0179   mfcheckerboard(inidx)=cidp(inidx)+(cid(inidx)-1)*true_nwedges;
0180 <span class="keyword">end</span>
0181 
0182 <span class="comment">%% generate a checkerboard mask</span>
0183 <span class="keyword">if</span> nargout&gt;=4, mask=logical(checkerboard); <span class="keyword">end</span>
0184 
0185 <span class="keyword">return</span></pre></div>
<hr><address>Generated on Tue 03-Aug-2021 14:14:51 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005 using a BVQX_hbtools customized template</address>
</body>
</html>